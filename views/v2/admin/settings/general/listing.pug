extends ../../layouts/master.pug

block csslib
	link(href='/admin/assets/plugins/custom/datatables/datatables.bundle.css' rel='stylesheet' type='text/css')
	link(href='/admin/assets/plugins/custom/jstree/jstree.bundle.css' rel='stylesheet' type='text/css')

block jslib
	// begin::Vendors Javascript(used by this page)
	script(src='/admin/assets/plugins/custom/datatables/datatables.bundle.js')
	// end::Vendors Javascript
	// begin::Custom Javascript(used by this page)
	script(src='https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js')
	script(src='https://cdn.jsdelivr.net/npm/lazyload@2.0.0-rc.2/lazyload.js')
	script(src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js")
	script(src='/admin/assets/js/custom/apps/ecommerce/catalog/products.js')
	script(src='/admin/assets/js/widgets.bundle.js')
	script(src='/admin/assets/js/custom/widgets.js')
	script(src='/admin/assets/js/custom/apps/chat/chat.js')
	script(src='/admin/assets/js/custom/utilities/modals/upgrade-plan.js')
	script(src='/admin/assets/js/custom/utilities/modals/create-app.js')
	script(src='/admin/assets/js/custom/utilities/modals/users-search.js')
	script(src='/admin/assets/plugins/custom/jstree/jstree.bundle.js')

	// Form Submission Script
	script(src='/common/js/form-data-json.min.js')
	script(src='/common/js/es-form.js')

block customScript
	script.
		function changeStatus(status,mode){
			fetch("/admin/settings/general/brand/change-status", {
				method: 'POST',
				cache: 'no-cache',
				headers: {
					Accept: 'application/json',
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					status,
					mode
				}),
			})
				.then(async (res) => {
					const status = res.status
					let data = await res.json()
					if (status >= 200 && status < 300) {
						location.reload()
					} else {
						Swal.fire({
							text: data.error || 'Something went wrong.',
							icon: 'warning',
							buttonsStyling: !1,
							confirmButtonText: 'Ok, got it!',
							customClass: {
								confirmButton: 'btn fw-bold btn-primary',
							},
						})
					}
				})
				.catch((err) => {
					Swal.fire({
						text: 'Something went wrong !.',
						icon: 'error',
						buttonsStyling: !1,
						confirmButtonText: 'Ok, got it!',
						customClass: {
							confirmButton: 'btn fw-bold btn-primary',
						},
					})
				})
		}
		function clearCache(){
			Swal.fire({
				text: 'Are you sure you want to clear cache ?',
				icon: 'warning',
				showCancelButton: !0,
				buttonsStyling: !1,
				confirmButtonText: 'Yes, Clear!',
				cancelButtonText: 'No, cancel',
				customClass: {
					confirmButton: 'btn fw-bold btn-danger',
					cancelButton: 'btn fw-bold btn-active-light-primary',
				},
			}).then((e) => {
				if (e.value) {
					fetch("/admin/settings/general/clear-cache", {
						method: 'POST',
						cache: 'no-cache',
						headers: {
							Accept: 'application/json',
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({

						}),
					})
						.then(async (res) => {
							const status = res.status
							let data = await res.json()
							if (status >= 200 && status < 300) {
								location.reload()
							} else {
								Swal.fire({
									text: data.error || 'Something went wrong.',
									icon: 'warning',
									buttonsStyling: !1,
									confirmButtonText: 'Ok, got it!',
									customClass: {
										confirmButton: 'btn fw-bold btn-primary',
									},
								})
							}
						})
						.catch((err) => {
							Swal.fire({
								text: 'Something went wrong !.',
								icon: 'error',
								buttonsStyling: !1,
								confirmButtonText: 'Ok, got it!',
								customClass: {
									confirmButton: 'btn fw-bold btn-primary',
								},
							})
						})
				}
			})
		}

block content
	.d-flex.flex-column.flex-column-fluid
		#kt_app_toolbar.app-toolbar.py-3.py-lg-6
			#kt_app_toolbar_container.app-container.container-xxl.d-flex.flex-stack
				.page-title.d-flex.flex-column.justify-content-center.flex-wrap.me-3
					h1.page-heading.d-flex.text-dark.fw-bold.fs-3.flex-column.justify-content-center.my-0
						| General Settings
					ul.breadcrumb.breadcrumb-separatorless.fw-semibold.fs-7.my-0.pt-1
						li.breadcrumb-item.text-muted
							a.text-muted.text-hover-primary(href='/admin/dashboard') Home
						li.breadcrumb-item
							span.bullet.bg-gray-400.w-5px.h-2px
						li.breadcrumb-item.text-muted Settings
						li.breadcrumb-item
							span.bullet.bg-gray-400.w-5px.h-2px
						li.breadcrumb-item.text-muted General
				//- .d-flex.align-items-center.gap-2.gap-lg-3
					a.btn.btn-sm.fw-bold.btn-primary(href='#' data-bs-toggle='modal' data-bs-target='#kt_modal_create_app') Add New

		#kt_app_content.app-content.flex-column-fluid
			#kt_app_content_container.app-container.container
				.row.g-5.g-xl-10.mb-xl-10
					.col-lg-4.col-md-6
						.card.mb-5.pb-4
							.card-header
								h3.card-title App Maintenance Mode
							.card-body
								.form-check.form-switch.form-check-custom.form-check-solid
									input#status-toggle-a.form-check-input.cursor-pointer(type='checkbox' checked=domain.maintenance_mode onChange='changeStatus('+domain.maintenance_mode+',1)' value=`${domain.maintenance_mode}`)
									label.form-check-label.cursor-pointer(for='status-toggle-a')
										if domain.maintenance_mode
											.badge.badge-light-danger Site in Maintenance Mode
										else 
											.badge.badge-light-success Site Active
					.col-lg-5.col-md-6
						.card.mb-5.pb-4
							.card-header
								h3.card-title E-Commerce Maintenance Mode
							.card-body
								.form-check.form-switch.form-check-custom.form-check-solid
									input#status-toggle-e.form-check-input.cursor-pointer(type='checkbox' checked=domain.ecommerce_maintenance_mode onChange='changeStatus('+domain.ecommerce_maintenance_mode+',2)' value=`${domain.ecommerce_maintenance_mode}`)
									label.form-check-label.cursor-pointer(for='status-toggle-e')
										if domain.ecommerce_maintenance_mode
											.badge.badge-light-danger Site in E-Commerce Maintenance Mode
										else 
											.badge.badge-light-success Site Active
					.col-lg-3
						.card.mb-5
							.card-header
								h3.card-title Clear all cache (REDIS)
							.card-body.text-center
								button.btn.btn-danger(onClick='clearCache()')
									i.las.la-trash.fs-2x
									| Flush Cache
				.row.g-5.g-xl-10.mb-xl-10
					.col-lg-12
						.card.mb-5
							.card-header
								h3.card-title Brand Logo
							.card-body
								//- .col-12.col-sm-6.col-md-4.col-lg-3.col-xl-3.col-xxl-3.text-center 
									//- if(brand && brand.logo && brand.logo.media_url)
									//- 	img.img-thumbnail.w-150px.h-150px.cursor-pointer(src=`${brand.logo.media_url}` alt="brand-logo" )
									//- else 
									//- 	img.img-thumbnail.w-150px.h-150px.cursor-pointer(src="/admin/assets/media/svg/files/blank-image.svg" alt="image" srcset="")
									//- a.btn.btn-primary.ms-5() Edit
								style.
									.image-input-placeholder {
										background-image: url('/admin/assets/media/svg/files/blank-image.svg');
										}
										[data-theme="dark"] .image-input-placeholder {
										background-image: url('/admin/assets/media/svg/files/blank-image-dark.svg');
									} 
								.image-input.image-input-empty.image-input-outline.image-input-placeholder(data-kt-image-input='true' )
									if(brand && brand.logo && brand.logo.en && brand.logo.en.media_url)
										.image-input-wrapper.w-200px.h-150px(id=`img-preview`  style=`background-image:url(${brand.logo.en.media_url}`)  
									else 
										.image-input-wrapper.w-125px.h-125px
									a.btn.btn-icon.btn-circle.btn-color-muted.btn-active-color-primary.w-25px.h-25px.bg-body.shadow(href=`/admin/settings/general/brand/change-logo/${brand._id}?brand=true` data-kt-image-input-action='change' data-bs-toggle='tooltip' data-bs-dismiss='click' title='Change Logo')
										i.bi.bi-pencil-fill.fs-7

								table.table.align-middle.table-row-dashed.fs-6.gy-5
									thead
										tr.text-start.text-gray-400.fw-bold.fs-7.text-uppercase.gs-0
											th.min-w-200px Logo
											th.min-w-200px Country
											th.text-end.min-w-70px Actions
									each item in brand.domains
										tr
											td
												.d-flex.align-items-center
													a.symbol.symbol-50px(href=`/admin/settings/general/brand/change-logo/${item.country._id}?domain=true`)
														if(item.logo && item.logo.en && item.logo.en.media_url)
															span.symbol-label(style=`background-image:url(${item.logo.en.media_url});`)
														else 
															span.symbol-label(style=`background-image:url(/admin/assets/media/svg/files/blank-image.svg);`)
													//- .ms-5
														a.text-gray-800.text-hover-primary.fs-5.fw-bold(href=`/admin/ecommerce/catalog/products/edit/${item._id}` data-kt-ecommerce-product-filter='product_name') #{item.country.name.en}
											td
												span.fw-bold.text-dark #{item.country.name.en}
											td.text-end
												a.btn.btn-sm.btn-light.btn-active-light-primary(href='#' data-kt-menu-trigger='click' data-kt-menu-placement='bottom-end')
													| Actions
													span.svg-icon.svg-icon-5.m-0
														svg(width='24' height='24' viewbox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg')
															path(d='M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z' fill='currentColor')
												.menu.menu-sub.menu-sub-dropdown.menu-column.menu-rounded.menu-gray-600.menu-state-bg-light-primary.fw-semibold.fs-7.w-125px.py-4(data-kt-menu='true')
													.menu-item.px-3
														a.menu-link.px-3(href=`/admin/settings/general/brand/change-logo/${item.country._id}?domain=true`) Edit





